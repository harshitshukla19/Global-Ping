<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Ping Test</title>
    <style>
        :root {
            --primary: #2563eb;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text: #1e293b;
            --border: #e2e8f0;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
        }

        h1 { margin: 0; font-size: 1.8rem; }
        p { color: #64748b; margin-top: 0.5rem; }

        .controls {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
        }

        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 32px;
            font-size: 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
            font-weight: 600;
        }

        button:hover { background-color: #1d4ed8; }
        button:disabled { background-color: #94a3b8; cursor: not-allowed; }

        .results-grid {
            display: grid;
            gap: 1rem;
        }

        .server-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: #fff;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .server-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .server-info { display: flex; flex-direction: column; }
        .server-name { font-weight: 600; font-size: 1.1rem; }
        .server-loc { font-size: 0.85rem; color: #64748b; }

        .latency-display {
            font-family: 'Courier New', monospace;
            font-weight: 700;
            font-size: 1.2rem;
        }

        /* Status Colors */
        .good { color: var(--success); }
        .avg { color: var(--warning); }
        .bad { color: var(--error); }
        
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Badge for rank */
        .rank-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            font-size: 0.75rem;
            margin-right: 10px;
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Global Ping Test</h1>
        <p>Test latency across USA, Singapore, Germany, UK, Australia, and India.</p>
    </header>

    <div class="controls">
        <button id="startBtn" onclick="runTests()">Start Test</button>
    </div>

    <div id="results" class="results-grid">
        <!-- Results will appear here -->
    </div>
</div>

<script>
    // CONFIGURATION: Target servers for each country
    const servers = [
        { name: "USA", url: "https://www.google.com", id: "usa" },
        { name: "Singapore", url: "https://www.lazada.sg", id: "singapore" },
        { name: "Germany", url: "https://www.amazon.de", id: "germany" },
        { name: "United Kingdom (UK)", url: "https://www.bbc.co.uk", id: "uk" },
        { name: "Australia", url: "https://www.abc.net.au", id: "australia" },
        { name: "Asia (India)", url: "https://www.amazon.in", id: "india" }
    ];

    // Store results for sorting
    let testResults = [];

    const resultsContainer = document.getElementById('results');
    const startBtn = document.getElementById('startBtn');

    // Initialize UI
    function init() {
        resultsContainer.innerHTML = '';
        testResults = [];
        servers.forEach(server => {
            resultsContainer.innerHTML += `
                <div class="server-card" id="card-${server.id}">
                    <div class="server-info">
                        <span class="server-name">${server.name}</span>
                        <span class="server-loc">Target: ${new URL(server.url).hostname}</span>
                    </div>
                    <div class="latency-display" id="latency-${server.id}">-- ms</div>
                </div>
            `;
        });
    }

    init();

    async function runTests() {
        startBtn.disabled = true;
        startBtn.innerText = "Testing...";
        
        // Reset displays
        testResults = [];
        const latencyDisplays = document.querySelectorAll('.latency-display');
        latencyDisplays.forEach(el => {
            el.innerHTML = '<div class="loader"></div>';
            el.className = 'latency-display';
        });

        // Run all fetches concurrently
        const promises = servers.map(server => performPing(server));
        
        await Promise.all(promises);

        // Automatically sort results after testing is complete
        sortResults();

        startBtn.disabled = false;
        startBtn.innerText = "Start Test";
    }

    async function performPing(server) {
        const display = document.getElementById(`latency-${server.id}`);
        
        try {
            const startTime = performance.now();

            await fetch(server.url, {
                method: 'GET',
                mode: 'no-cors',
                cache: 'no-store'
            });

            const endTime = performance.now();
            const latency = Math.round(endTime - startTime);

            display.innerText = `${latency} ms`;
            display.classList.add(getLatencyClass(latency));

            // Store result for sorting
            testResults.push({
                id: server.id,
                name: server.name,
                hostname: new URL(server.url).hostname,
                latency: latency,
                class: getLatencyClass(latency)
            });

        } catch (error) {
            console.error(`Error testing ${server.name}:`, error);
            display.innerText = "Failed";
            display.classList.add('bad');
            
            // Store failed result
            testResults.push({
                id: server.id,
                name: server.name,
                hostname: new URL(server.url).hostname,
                latency: 99999,
                class: 'bad'
            });
        }
    }

    function getLatencyClass(latency) {
        if (latency < 100) return 'good';
        if (latency < 250) return 'avg';
        return 'bad';
    }

    // Automatic sort function
    function sortResults() {
        // Sort by latency (ascending - lowest first)
        testResults.sort((a, b) => a.latency - b.latency);

        // Rebuild the DOM with sorted results
        resultsContainer.innerHTML = '';
        
        testResults.forEach((result, index) => {
            resultsContainer.innerHTML += `
                <div class="server-card">
                    <div class="server-info">
                        <span class="server-name">
                            <span class="rank-badge">${index + 1}</span>
                            ${result.name}
                        </span>
                        <span class="server-loc">Target: ${result.hostname}</span>
                    </div>
                    <div class="latency-display ${result.class}">
                        ${result.latency === 99999 ? 'Failed' : result.latency + ' ms'}
                    </div>
                </div>
            `;
        });
    }
</script>

</body>
</html>
